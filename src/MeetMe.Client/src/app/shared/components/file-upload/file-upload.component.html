<div class="file-upload-container">
  <div
    class="upload-area"
    [class.drag-over]="isDragOver"
    [class.uploading]="isUploading"
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)"
    (drop)="onDrop($event)"
    *ngIf="dragAndDrop"
  >
    <div class="upload-content" *ngIf="!isUploading">
      <app-icon name="upload" [size]="48" cssClass="upload-icon"></app-icon>
      <h3>Drop files here or click to browse</h3>
      <p>{{ acceptedTypes === '*' ? 'Any file type' : 'Accepted types: ' + acceptedTypes }}</p>
      <p class="file-size-info">Maximum file size: {{ formatFileSize(maxFileSize) }}</p>
      <input
        type="file"
        class="file-input"
        [accept]="acceptedTypes"
        [multiple]="multiple"
        (change)="onFileSelect($event)"
      />
    </div>

    <div class="upload-progress" *ngIf="isUploading">
      <app-icon name="upload" [size]="32" cssClass="upload-icon spinning"></app-icon>
      <h3>Uploading files...</h3>
      <div class="progress-list">
        <div class="progress-item" *ngFor="let progress of uploadProgresses | keyvalue">
          <div class="progress-info">
            <span class="file-name">{{ progress.key.split('_')[0] }}</span>
            <span class="progress-percent">{{ progress.value.progress }}%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="progress.value.progress"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Simple file input for non-drag-and-drop -->
  <div class="simple-upload" *ngIf="!dragAndDrop">
    <label class="upload-button">
      <app-icon name="upload" [size]="20"></app-icon>
      <span>{{ multiple ? 'Choose Files' : 'Choose File' }}</span>
      <input
        type="file"
        class="file-input"
        [accept]="acceptedTypes"
        [multiple]="multiple"
        (change)="onFileSelect($event)"
      />
    </label>
  </div>

  <!-- Uploaded files list -->
  <div class="uploaded-files" *ngIf="uploadedFiles.length > 0">
    <h4>Uploaded Files</h4>
    <div class="file-list">
      <div class="file-item" *ngFor="let file of uploadedFiles; let i = index">
        <div class="file-info">
          <app-icon [name]="getFileIcon(file)" [size]="24" cssClass="file-icon"></app-icon>
          <div class="file-details">
            <span class="file-name">{{ file.originalName }}</span>
            <span class="file-size">{{ formatFileSize(file.fileSize) }}</span>
          </div>
        </div>
        <div class="file-actions">
          <a
            [href]="file.downloadUrl"
            download
            class="btn-icon"
            title="Download"
          >
            <app-icon name="download" [size]="16"></app-icon>
          </a>
          <button
            class="btn-icon btn-danger"
            (click)="removeFile(i)"
            title="Remove"
          >
            <app-icon name="x" [size]="16"></app-icon>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
