<div class="post-detail-container">
  <div class="loading" *ngIf="isLoading">
    <p>Loading post...</p>
  </div>

  <div class="error-message" *ngIf="errorMessage">
    <p>{{ errorMessage }}</p>
  </div>

  <div class="post-detail" *ngIf="post && !isLoading">
    <!-- Post Content -->
    <div class="post-card">
      <div class="post-header">
        <div class="author-info">
          <h2>{{ post.author.firstName }} {{ post.author.lastName }}</h2>
          <span class="post-date">{{ post.createdAt | date:'medium' }}</span>
        </div>
        <div class="post-actions" *ngIf="canDeletePost()">
          <button
            class="btn btn-danger btn-small"
            (click)="onDeletePost()"
            title="Delete post"
          >
            Delete Post
          </button>
        </div>
      </div>

      <div class="post-content">
        <p>{{ post.content }}</p>
      </div>

      <div class="post-footer">
        <div class="post-stats">
          <span class="comments-count">
            {{ comments.length }} {{ comments.length === 1 ? 'comment' : 'comments' }}
          </span>
        </div>
        <div class="post-footer-actions">
          <a
            [routerLink]="['/meetings', post.meetingId]"
            class="btn btn-outline btn-small"
          >
            Back to Meeting
          </a>
        </div>
      </div>
    </div>

    <!-- Add Comment Form -->
    <div class="comment-form-container">
      <h3>Add a Comment</h3>
      <form [formGroup]="commentForm" (ngSubmit)="onSubmitComment()">
        <div class="form-group">
          <textarea
            formControlName="content"
            class="form-control"
            [class.error]="commentForm.get('content')?.invalid && commentForm.get('content')?.touched"
            placeholder="Write your comment..."
            rows="3"
          ></textarea>
          <div class="error-message" *ngIf="commentForm.get('content')?.invalid && commentForm.get('content')?.touched">
            <small *ngIf="commentForm.get('content')?.errors?.['required']">Please enter a comment</small>
          </div>
        </div>

        <div class="form-actions">
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="commentForm.invalid || isSubmittingComment"
          >
            {{ isSubmittingComment ? 'Adding Comment...' : 'Add Comment' }}
          </button>
        </div>
      </form>
    </div>

    <!-- Comments List -->
    <div class="comments-section">
      <h3>Comments</h3>

      <div class="no-comments" *ngIf="comments.length === 0">
        <p>No comments yet. Be the first to comment!</p>
      </div>

      <div class="comments-list" *ngIf="comments.length > 0">
        <div
          *ngFor="let comment of comments; trackBy: trackByCommentId"
          class="comment-card"
        >
          <div class="comment-header">
            <div class="comment-author">
              <h4>{{ comment.author.firstName }} {{ comment.author.lastName }}</h4>
              <span class="comment-date">{{ comment.createdAt | date:'medium' }}</span>
            </div>
            <div class="comment-actions" *ngIf="canDeleteComment(comment)">
              <button
                class="btn btn-danger btn-small"
                (click)="onDeleteComment(comment.id)"
                title="Delete comment"
              >
                Delete
              </button>
            </div>
          </div>

          <div class="comment-content">
            <p>{{ comment.content }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
